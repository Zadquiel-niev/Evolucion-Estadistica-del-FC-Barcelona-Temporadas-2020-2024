---
title: "ANÁLSIS ESTADÍSTICO DEL FC BARCELONA EN LAS TEMPORADAS 2020-2024"
author: "Jose Aguirre y Zadquiel Nieves"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
---

# Planteamiento de Problema

El FC Barcelona es una de las instituciones deportivas más importantes del mundo. Su rendimiento en La Liga depende de muchos factores, desde el 2020 hasta 2024, el equipo ha cambiado mucho, se ha pasado de buscar entender qué pasa, a ver qué funciona mejor. 

# Justificación del Problema

El fútbol actual depende cada vez más del análisis de datos, para un club como el Barcelona, con altas expectativas y un estilo de juego definido, usar estadísticas básicas es muy importante para:

- Detectar fortalezas y debilidades en diferentes situaciones, como partidos en casa o fuera.

- Mejorar la alineación, las estrategias según los rivales y las circunstancias.

- Medir cómo influyen los jugadores importantes en la creación de juego y en marcar goles, también defender bien.

- De cambio Entender el rendimiento en un momento tras la era Messi y en medio de problemas económicos.

- Este análisis ayudará a entender cómo ha evolucionado el equipo más allá de las opiniones personales, usando datos reales de La Liga.

# Objetivo General

Evaluar la evolución táctica y de rendimiento ofensivo del Fútbol Club Barcelona durante las temporadas 2020 a 2024, mediante el análisis estadístico y la visualización de métricas avanzadas como la Posesión (poss), Goles Esperados (xg), Goles esperados en contra (xga), Goles (gf), Goles en contra (ga), Resultado de los partidos en casa y afuera más Formaciones Tácticas. Y ver si esto ayudó al FC Barcelona a levantarse en una de sus peores temporadas en la historia (2020-2021)

## Objetivos Específicos
- Cuantificar la tendencia anual de las métricas clave de rendimiento (Goles a Favor, Goles en Contra, y Porcentaje de Posesión) para determinar la dirección de la evolución del modelo de juego del equipo.
- Establecer la relación de correlación (fuerza y dirección) entre el Porcentaje de Posesión y la Eficiencia de Oportunidades (poss, xg, xga) a nivel de partido, viendo los resultados por temporada.
- Determinar si existe una diferencia estadísticamente significativa en el Puntos por temporadas obtenidos por el club en función de las Formaciones Tácticas (formation) más utilizadas en cada temporada.

# Breve Historia

El FC Barcelona cambió mucho entre 2020 y 2024, después de que Messi se fue en 2021, el club pasó por estos cambios:

- Cambio en el entrenador: De Ronald Koeman a Xavi Hernández, si hubo cambios a nivel de juego.

- Promoción de jóvenes: Llegaron Pedri, Gavi, Lamine Yamal y fichajes como Lewandowski, Raphinha y Koundé entre otros.

- Cambio en la estrategia: Dejaron de usar solo el 3-5-2 y probaron formaciones más variadas como el 4-2-3-1 y el 4-3-3 con doble pivote.

- Resultados: Ganaron mucho en La Liga, pero tuvieron problemas en la Champions League en algunos momentos (todavía).

Este período explica los datos que vemos, Se trata de cambios y adaptaciones constantes.

# Marco Metodológico

## Fuente de Datos y Tiempo

Usamos el conjunto de datos completo matches_full_la_liga.csv. Este conjunto tiene registros de partidos de La Liga desde 2020-2021 hasta 2024-2025. Tiene 4,319 filas. Es una base de datos que muestra la competencia del fútbol español en ese periodo. Las variables incluyen datos cuantitativos y cualitativos. Algunas variables importantes son:

- Resultados: gf (goles a favor), ga (goles en contra), result (resultado)
- Rendimiento: poss (posesión), sh (tiros), sot (tiros a puerta), xg (goles esperados),
 xga (Goles esperado en contra) dist (distancia en total recorrida en el partido)
- Variables de contexto: formación (formación), attendance (asistencia), venue (localía)

## Variables y Análisis

El estudio tiene cuatro partes principales, cada una ayuda a entender el rendimiento del equipo:
Rendimiento en Casa y Fuera: Comparamos el equipo cuando juega en su campo y cuando juega afuera, goles y goles en contra, esto muestra si el equipo actúa diferente según el lugar de juego.
Posesión y Goles:  Evaluamos la relación entre cuánto controla el balón, las oportunidades y los goles. Esto nos ayuda a entender si la posesión lleva a más goles esperados y si el equipo es eficiente en ataque.
Formaciones y Tácticas: Analizamos cómo cambia la estrategia del equipo, revisión de formaciones y rotaciones del plantel en cada temporada, esto revela cómo evoluciona el estilo de juego.

# Infraestructura y Herramientas

Usamos tecnología para analizar los datos. Combinamos estadísticas con visualizaciones:

R, Rmarkdown: Aquí hicimos nuestro PDF. Respondimos las preguntas del planteamiento del problema. También presentamos nuestras investigaciones sobre la evolución del Barcelona de 2020 a 2024.

Python, Pandas, Plotly, Matplotlib: Desarrollamos una aplicación web usando Streamlit. La interfaz permite filtrar datos y ver patrones. También muestra gráficos interactivos relacionados con nuestro trabajo y nuestras investigaciones.

# Proceso de Trabajo

El trabajo tiene **cuatro fases principales**:

- **Fase 1: Preparación de datos**: Filtración y limpieza de los registros del FC Barcelona para el período 2020-2024.

- **Fase 2: Cálculos estadísticos descriptivos**: Análisis de tendencias, medidas de centralidad, dispersión, y distribución de variables clave.

- **Fase 3: Visualización avanzada**: Creación de gráficos y tablas para representar los hallazgos estadísticos.

- **Fase final: Conclusiones**: Síntesis de resultados y respuesta a los objetivos planteados.

Este método garantiza resultados confiables y útiles. Proporciona información clara para nosotros y también quienes toman decisiones en el club, desde técnicos hasta directivos.

```{r setup, include=FALSE}
# 
knitr::opts_chunk$set(
	echo = TRUE,
	fig.align = "center",
	message = FALSE,
	warning = FALSE
)
library(dplyr)
library(ggplot2)
library(readr)
library(plotly)
library(patchwork)

# Cargar y filtrar datos del Barcelona
matches_full_la_liga <- read_csv('matches_full_la_liga.csv')

# Limpiar caracteres especiales de las formaciones
matches_full_la_liga$formation <- gsub("◆", "", matches_full_la_liga$formation)

# Filtrado principal - solo partidos del Barcelona 2020-2024
barca_data <- matches_full_la_liga %>% 
  filter(team == "Barcelona", season %in% c(2020, 2021, 2022, 2023, 2024))

cat("- Total de partidos cargados:", nrow(matches_full_la_liga), "\n")
cat("- Partidos del Barcelona analizados:", nrow(barca_data), "\n")
cat("- Temporadas incluidas:", paste(unique(barca_data$season), collapse = ", "), "\n")
```

```{r calculos_estadisticos, echo=FALSE}
# 
tendencias_anuales <- barca_data %>%
  group_by(season) %>%
  summarise(
    partidos_jugados = n(),
    goles_favor = sum(gf, na.rm = TRUE),
    goles_contra = sum(ga, na.rm = TRUE),
    promedio_gf = mean(gf, na.rm = TRUE),
    mediana_gf = median(gf, na.rm = TRUE),
    sd_gf = sd(gf, na.rm = TRUE),
    promedio_ga = mean(ga, na.rm = TRUE),
    mediana_ga = median(ga, na.rm = TRUE),
    sd_ga = sd(ga, na.rm = TRUE),
    promedio_posesion = mean(poss, na.rm = TRUE),
    sd_posesion = sd(poss, na.rm = TRUE),
    promedio_xg = mean(xg, na.rm = TRUE),
    promedio_xga = mean(xga, na.rm = TRUE),
    victorias = sum(result == "W", na.rm = TRUE),
    empates = sum(result == "D", na.rm = TRUE),
    derrotas = sum(result == "L", na.rm = TRUE),
    puntos = (victorias * 3) + empates
  ) %>%
  mutate(
    efectividad = (puntos / (partidos_jugados * 3)) * 100,
    diferencia_goles = goles_favor - goles_contra
  )

# Estadticas descriptivas globales
estadisticas_globales <- data.frame(
  Variable = c("Goles a Favor", "Goles en Contra", "Posesión (%)"),
  Media = c(mean(barca_data$gf, na.rm = TRUE), 
            mean(barca_data$ga, na.rm = TRUE), 
            mean(barca_data$poss, na.rm = TRUE)),
  Mediana = c(median(barca_data$gf, na.rm = TRUE), 
              median(barca_data$ga, na.rm = TRUE), 
              median(barca_data$poss, na.rm = TRUE)),
  Desviación_Estándar = c(sd(barca_data$gf, na.rm = TRUE), 
                         sd(barca_data$ga, na.rm = TRUE), 
                         sd(barca_data$poss, na.rm = TRUE)),
  Mínimo = c(min(barca_data$gf, na.rm = TRUE), 
             min(barca_data$ga, na.rm = TRUE), 
             min(barca_data$poss, na.rm = TRUE)),
  Máximo = c(max(barca_data$gf, na.rm = TRUE), 
             max(barca_data$ga, na.rm = TRUE), 
             max(barca_data$poss, na.rm = TRUE))
)

# Analisis por localida
rendimiento_venue <- barca_data %>%
  group_by(venue) %>%
  summarise(
    partidos = n(),
    media_gf = mean(gf, na.rm = TRUE),
    sd_gf = sd(gf, na.rm = TRUE),
    media_ga = mean(ga, na.rm = TRUE),
    sd_ga = sd(ga, na.rm = TRUE),
    media_poss = mean(poss, na.rm = TRUE),
    victorias = sum(result == "W", na.rm = TRUE),
    porcentaje_victorias = (victorias / partidos) * 100,
    puntos_por_partido = mean(ifelse(result == "W", 3, 
                                    ifelse(result == "D", 1, 0)), na.rm = TRUE)
  )

#  Analisis de formaciones
formaciones_analisis <- barca_data %>%
  group_by(formation) %>%
  summarise(
    partidos = n(),
    frecuencia_relativa = (n() / nrow(barca_data)) * 100,
    media_puntos = mean(ifelse(result == "W", 3, 
                              ifelse(result == "D", 1, 0)), na.rm = TRUE),
    media_gf = mean(gf, na.rm = TRUE),
    media_ga = mean(ga, na.rm = TRUE),
    media_poss = mean(poss, na.rm = TRUE),
    sd_gf = sd(gf, na.rm = TRUE),
    eficiencia = media_gf / mean(xg, na.rm = TRUE)
  ) %>%
  filter(partidos >= 1) %>%  # Solo formaciones usadas en al menos 5 partidos
  arrange(desc(media_puntos))

#Distribucion de resultados
distribucion_resultados <- barca_data %>%
  group_by(result) %>%
  summarise(
    frecuencia = n(),
    porcentaje = (n() / nrow(barca_data)) * 100
  )

View(formaciones_analisis)

```

```{r tabla1, echo=FALSE}

# tabla1
tabla1_rendimiento <- tendencias_anuales %>%
  select(
    season, partidos_jugados, victorias, empates, derrotas, puntos, efectividad
  )

knitr::kable(tabla1_rendimiento, 
             caption = "Tabla 1: Rendimiento General y Puntos por Temporada",
             digits = 1)
```

Interpretación Tabla 1: El análisis del rendimiento general muestra cambios en la competencia entre 2020 y 2024. El equipo mejoró su capacidad para obtener puntos. La eficiencia aumentó del 64% en 2022 al 77,2% en 2023. La temporada 2023 fue la más exitosa. Se lograron 28 victorias y solo 6 derrotas en ese año. Además, se alcanzó un máximo de 88 puntos. Esto indica que el equipo pudo convertir su rendimiento en resultados en los últimos años. Esto ocurrió después de un período con menos consistencia.

```{r tabla2, echo=FALSE}
# Tabla de goles y posesión 
tabla2_metricas <- tendencias_anuales %>%
  select(
    season, promedio_gf, sd_gf, promedio_ga, sd_ga, diferencia_goles, 
    promedio_posesion, sd_posesion, promedio_xg, promedio_xga
  ) %>%
  rename(
    'Prom. GF' = promedio_gf,
    'SD GF' = sd_gf,
    'Prom. GC' = promedio_ga,
    'SD GC' = sd_ga,
    'Dif. Goles' = diferencia_goles,
    'Prom. Poss (%)' = promedio_posesion,
    'SD Poss' = sd_posesion
  )

knitr::kable(tabla2_metricas, 
             caption = "Tabla 2: Estadísticas Descriptivas de Goles y Posesión por Temporada",
             digits = 2)
```

Interpretación Tabla 2: Los datos confirman una fuerte adherencia al modelo de juego de control durante todo el período, con el promedio de posesión (Prom. Poss) manteniéndose constantemente alto, en un rango estrecho de 64.16% a 66.39% y una baja desviación estándar (SD). No obstante, la métrica defensiva mostró la mejora más dramática y eficiente en la temporada 2023, donde el promedio de Goles en Contra (Prom. GC) se redujo a 0.53, resultando en la mayor diferencia de goles (+50) para el equipo en las cinco temporadas. Si bien la producción ofensiva (Prom. GF) fue más alta en 2020 y 2021, la combinación de una defensa sólida y una ofensiva eficiente en 2023 fue la clave del éxito en puntos.

```{r tabla3, echo=FALSE}
#Tabls Estadisticas Desriptivas Globales
tabla_globales <- data.frame(
  Métrica = c("Goles a Favor", "Goles en Contra", "Posesión"),
  Media = c(estadisticas_globales$Media[1], 
           estadisticas_globales$Media[2],
           estadisticas_globales$Media[3]),
  Mediana = c(estadisticas_globales$Mediana[1],
             estadisticas_globales$Mediana[2],
             estadisticas_globales$Mediana[3]),
  SD = c(estadisticas_globales$Desviación_Estándar[1],
        estadisticas_globales$Desviación_Estándar[2],
        estadisticas_globales$Desviación_Estándar[3]),
  Mínimo = c(estadisticas_globales$Mínimo[1],
            estadisticas_globales$Mínimo[2],
            estadisticas_globales$Mínimo[3]),
  Máximo = c(estadisticas_globales$Máximo[1],
            estadisticas_globales$Máximo[2],
            estadisticas_globales$Máximo[3])
)

knitr::kable(tabla_globales, 
             caption = "Tabla 3: Estadísticas Descriptivas Globales (2020-2024)",
             digits = 2)
```

Interpretación Tabla 3: A nivel global del período, el FC Barcelona mantuvo un promedio de posesión muy alto del 64.93%. El promedio de Goles a Favor (GF) fue de 2.04 por partido. La desviación estándar (SD) de GF fue de 1.44. Esto significa que la cantidad de goles en ofensiva varió entre partidos. El menor número de goles fue 0 y el mayor fue 6. El promedio de Goles en Contra (GC) fue de 0.94. Esto indica que la defensa fue fuerte. Algunos partidos tuvieron hasta 5 goles recibidos.